box: debian
build:
  steps:
    - script:
        name: initialize
        code: |
          export DEBIAN_FRONTEND=noninteractive
          apt-get update
          apt-get install -y python-pip libffi-dev libssl-dev
          pip install blobxfer
          mkdir output
    - script:
        name: parepare webapp 
        code: |
          tar zcf output/webapp.tar.gz --exclude=.gitignore webapp
    - script:
        name: parepare ansible 
        code: |
          tar zcf output/ansible.tar.gz ansible
    #- script:
    #    name: prepare provisioning
    #    code: |
    #      cp azure/provisioning_isu01.sh output/
    #      cp azure/provisioning_isu02.sh output/
    - script:
        name: upload blob
        code: |
          cd output
          blobxfer --storageaccountkey "$AZURE_STORAGE_KEY" --upload "$AZURE_STORAGE_ACCOUNT" "$CONTAINER_NAME" .
